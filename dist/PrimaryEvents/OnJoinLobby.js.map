{"version":3,"sources":["../../src/PrimaryEvents/OnJoinLobby.ts"],"names":["name","lobbyId","resolve","id","player","pg","createPlayer","lobby","getLobby","createLobby","game","meta","allowJoiningWhileRunning","emit","reason","addPlayer","authString"],"mappings":";;;;;;;AAAA;;AAEA;;;;AAEA;AACe,kBAAU;AAAEA,EAAAA,IAAF;AAAQC,EAAAA;AAAR,CAAV,EAAgEC,OAAhE,EAA2F;AACzG,qBAAK,IAAL,EAAW,KAAKC,EAAhB,EAAoB,qBAApB,EAA2CF,OAA3C;;AAEA,QAAMG,MAAM,GAAGC,YAAGC,YAAH,CAAgBN,IAAhB,EAAsB,IAAtB,CAAf;;AACA,QAAMO,KAAK,GAAGF,YAAGG,QAAH,CAAYP,OAAZ,KAAwBI,YAAGI,WAAH,CAAeL,MAAf,CAAtC;;AAEA,MAAIG,KAAK,CAACG,IAAN,IAAc,CAAEH,KAAK,CAACG,IAAN,CAAWC,IAAX,CAAgBC,wBAApC,EAA8D;AAC7D,WAAO,KAAKC,IAAL,CAAU,mBAAV,EAA+B;AAAEC,MAAAA,MAAM,EAAE;AAAV,KAA/B,CAAP;AACA;;AAEDP,EAAAA,KAAK,CAACQ,SAAN,CAAgBX,MAAhB;AAEAF,EAAAA,OAAO,CAAC;AACPD,IAAAA,OAAO,EAAEM,KAAK,CAACJ,EADR;AAEPa,IAAAA,UAAU,EAAEZ,MAAM,CAACY;AAFZ,GAAD,CAAP;AAIA","sourcesContent":["import pg from 'pg'\nimport SocketIoResolver from '../Contracts/SocketIoResolver'\nimport { info } from 'helpers'\n\n// TODO what happens when this recieves an object without name property? does the whole app blow up? it shouldnt\nexport default function ({ name, lobbyId }: { name: string, lobbyId: string }, resolve: SocketIoResolver) {\n\tinfo('L+', this.id, 'wants to join lobby', lobbyId)\n\n\tconst player = pg.createPlayer(name, this)\n\tconst lobby = pg.getLobby(lobbyId) || pg.createLobby(player)\n\n\tif (lobby.game && ! lobby.game.meta.allowJoiningWhileRunning) {\n\t\treturn this.emit('cannot join lobby', { reason: 'already in a game' })\n\t}\n\n\tlobby.addPlayer(player)\n\n\tresolve({\n\t\tlobbyId: lobby.id,\n\t\tauthString: player.authString,\n\t})\n}\n"],"file":"OnJoinLobby.js"}